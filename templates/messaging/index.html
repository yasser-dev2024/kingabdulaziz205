{% load static %}
<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>المراسلات</title>
<style>
  body{margin:0;font-family:system-ui,Tajawal,Arial;background:#f6f8fb;color:#0f172a}
  .wrap{max-width:1100px;margin:auto;padding:20px 14px}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 16px}
  .tab{padding:8px 12px;border-radius:999px;border:1px solid #e5e7eb;background:#fff;font-weight:800;text-decoration:none;color:#111827}
  .tab.active{background:linear-gradient(90deg,#06b6d4,#4f46e5);color:#fff;border-color:transparent}
  .list{display:grid;gap:10px}
  .item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px;border:1px solid #eef2f7;border-radius:12px;background:#fff}
  .meta{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .badge{padding:4px 8px;border-radius:999px;font-size:12px;font-weight:900}
  .b-new{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}
  .chip{padding:6px 10px;border-radius:999px;background:#f1f5f9;border:1px solid #e5e7eb}
  .link{font-weight:900;color:#1d4ed8;text-decoration:none}
</style>
</head>
<body>
{% include 'header.html' %}
<div class="wrap">

  <div class="tabs">
    <a class="tab {% if scope == 'all' %}active{% endif %}" href="{% url 'messaging:inbox' %}?scope=all">الكل ({{ counts.all }})</a>
    <a class="tab {% if scope == 'sent' %}active{% endif %}" href="{% url 'messaging:inbox' %}?scope=sent">مرسلة ({{ counts.sent }})</a>
    <a class="tab {% if scope == 'inbox' %}active{% endif %}" href="{% url 'messaging:inbox' %}?scope=inbox">واردة ({{ counts.inbox }})</a>
    <a class="tab" href="{% url 'messaging:new' %}">+ رسالة جديدة</a>
  </div>

  <div class="list">
    {% for t in items %}
      <div class="item {% if t.is_new_incoming %}is-new-card{% endif %}">
        <div class="meta">
          {% if t.is_new_incoming %}<span class="badge b-new">جديدة</span>{% endif %}
          <a class="link" href="{% url 'messaging:detail' t.pk %}">{{ t.reference }}</a>
          <div class="chip">الموضوع: {{ t.subject }}</div>
          <div class="chip">من: {{ t.sender.username }}</div>
          <div class="chip">إلى: {{ t.recipient.username }}</div>
        </div>
        <div class="meta">
          {% if t.last_message %}<span class="chip">آخر رد: {{ t.last_message.created_at|date:"Y/m/d H:i" }}</span>{% endif %}
          <span class="chip">الحالة: {{ t.get_status_display }}</span>
        </div>
      </div>
    {% empty %}
      <div>لا توجد مراسلات.</div>
    {% endfor %}
  </div>

</div>
{% include 'footer.html' %}
</body>
</html>
