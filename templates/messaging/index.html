{% load static %}
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>مراسلاتي</title>
  <style>
    :root{--brand:#1f3c88;--brand2:#2ebfa5;--accent:#ffb703;--txt:#0f172a;--bg:#f8fafc}
    body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Tajawal,Arial;color:var(--txt);
         cursor:url("{% static 'maus.png' %}") 12 12, auto}
    a,button,.btn{cursor:inherit}
    .wrap{max-width:1100px;margin:auto;padding:18px 16px}
    .head{display:flex;align-items:center;justify-content:space-between;margin:10px 0 14px}
    .head h1{margin:0;font-size:clamp(20px,3vw,28px)}
    .btn{appearance:none;border:none;border-radius:14px;padding:12px 16px;font-weight:800;display:inline-flex;gap:8px;text-decoration:none}
    .btn-primary{background:linear-gradient(100deg,var(--brand) 0%, color-mix(in srgb,var(--brand2) 70%, var(--brand) 30%) 100%);color:#fff}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
    .card{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:18px;padding:14px}
    .muted{color:#64748b}
    @media (max-width:800px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  {% include 'header.html' %}
  <div class="wrap">
    <div class="head">
      <h1>مراسلاتي</h1>
      <a class="btn btn-primary" href="{% url 'messaging:new' %}">إنشاء مراسلة</a>
    </div>

    {% if items %}
      <div class="grid">
        {% for t in items %}
          <div class="card">
            <div><strong>{{ t.subject }}</strong></div>
            <div class="muted">
              مرجع: {{ t.reference }} • الحالة: {{ t.get_status_display }}<br>
              من: {{ t.sender.username }} • إلى: {{ t.recipient.username }} • {{ t.created_at|date:"Y-m-d H:i" }}
            </div>
            <div style="margin-top:8px">
              <a class="btn" style="border:1px solid rgba(0,0,0,.12)" href="{% url 'messaging:detail' t.pk %}">فتح</a>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="card muted">لا توجد مراسلات حتى الآن.</div>
    {% endif %}
  </div>
  {% include 'footer.html' %}
</body>
</html>
